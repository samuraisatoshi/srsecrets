import 'package:flutter/material.dart';
import 'package:flutter_test/flutter_test.dart';

import '../../lib/presentation/theme/app_theme.dart';
import '../../lib/presentation/widgets/pin_input_widget.dart';
import '../../lib/presentation/widgets/error_display_widget.dart';
import '../../lib/presentation/widgets/secret_form_header.dart';
import '../../lib/presentation/widgets/share_input_widget.dart';
import '../../lib/presentation/widgets/threshold_config_widget.dart';

void main() {
  group('Widget Golden Tests', () {
    
    testWidgets('PIN input widget - light theme', (tester) async {
      await tester.pumpWidget(\n        MaterialApp(\n          theme: AppTheme.lightTheme,\n          home: Scaffold(\n            body: Center(\n              child: SizedBox(\n                width: 300,\n                height: 400,\n                child: PinInputWidget(\n                  onCompleted: (pin) {},\n                  maxLength: 6,\n                ),\n              ),\n            ),\n          ),\n        ),\n      );\n      \n      await expectLater(\n        find.byType(PinInputWidget),\n        matchesGoldenFile('pin_input_light.png'),\n      );\n    });\n    \n    testWidgets('PIN input widget - dark theme', (tester) async {\n      await tester.pumpWidget(\n        MaterialApp(\n          theme: AppTheme.darkTheme,\n          home: Scaffold(\n            body: Center(\n              child: SizedBox(\n                width: 300,\n                height: 400,\n                child: PinInputWidget(\n                  onCompleted: (pin) {},\n                  maxLength: 6,\n                ),\n              ),\n            ),\n          ),\n        ),\n      );\n      \n      await expectLater(\n        find.byType(PinInputWidget),\n        matchesGoldenFile('pin_input_dark.png'),\n      );\n    });\n    \n    testWidgets('PIN input widget - loading state', (tester) async {\n      await tester.pumpWidget(\n        MaterialApp(\n          theme: AppTheme.lightTheme,\n          home: Scaffold(\n            body: Center(\n              child: SizedBox(\n                width: 300,\n                height: 400,\n                child: PinInputWidget(\n                  onCompleted: (pin) {},\n                  isLoading: true,\n                ),\n              ),\n            ),\n          ),\n        ),\n      );\n      \n      await expectLater(\n        find.byType(PinInputWidget),\n        matchesGoldenFile('pin_input_loading.png'),\n      );\n    });\n    \n    testWidgets('error display widget - light theme', (tester) async {\n      await tester.pumpWidget(\n        MaterialApp(\n          theme: AppTheme.lightTheme,\n          home: Scaffold(\n            body: Center(\n              child: SizedBox(\n                width: 350,\n                child: ErrorDisplayWidget(\n                  errorMessage: 'This is a test error message that might be quite long and span multiple lines to test the layout.',\n                  onDismiss: () {},\n                ),\n              ),\n            ),\n          ),\n        ),\n      );\n      \n      await expectLater(\n        find.byType(ErrorDisplayWidget),\n        matchesGoldenFile('error_display_light.png'),\n      );\n    });\n    \n    testWidgets('error display widget - dark theme', (tester) async {\n      await tester.pumpWidget(\n        MaterialApp(\n          theme: AppTheme.darkTheme,\n          home: Scaffold(\n            body: Center(\n              child: SizedBox(\n                width: 350,\n                child: ErrorDisplayWidget(\n                  errorMessage: 'This is a test error message that might be quite long and span multiple lines to test the layout.',\n                  onDismiss: () {},\n                ),\n              ),\n            ),\n          ),\n        ),\n      );\n      \n      await expectLater(\n        find.byType(ErrorDisplayWidget),\n        matchesGoldenFile('error_display_dark.png'),\n      );\n    });\n    \n    testWidgets('secret form header - with info text', (tester) async {\n      await tester.pumpWidget(\n        MaterialApp(\n          theme: AppTheme.lightTheme,\n          home: Scaffold(\n            body: Center(\n              child: SizedBox(\n                width: 400,\n                child: SecretFormHeader(\n                  title: 'Create Secret Shares',\n                  subtitle: 'Split your secret into multiple shares using Shamir\\'s Secret Sharing algorithm',\n                  icon: Icons.add_circle_outline,\n                  infoText: 'You can configure the number of shares and threshold required for reconstruction.',\n                ),\n              ),\n            ),\n          ),\n        ),\n      );\n      \n      await expectLater(\n        find.byType(SecretFormHeader),\n        matchesGoldenFile('secret_form_header_with_info.png'),\n      );\n    });\n    \n    testWidgets('secret form header - without info text', (tester) async {\n      await tester.pumpWidget(\n        MaterialApp(\n          theme: AppTheme.lightTheme,\n          home: Scaffold(\n            body: Center(\n              child: SizedBox(\n                width: 400,\n                child: SecretFormHeader(\n                  title: 'Reconstruct Secret',\n                  subtitle: 'Enter the required shares to reconstruct your secret',\n                  icon: Icons.restore,\n                ),\n              ),\n            ),\n          ),\n        ),\n      );\n      \n      await expectLater(\n        find.byType(SecretFormHeader),\n        matchesGoldenFile('secret_form_header_no_info.png'),\n      );\n    });\n    \n    testWidgets('share input widget - removable', (tester) async {\n      final controller = TextEditingController(text: 'Sample share data that might be quite long');\n      final focusNode = FocusNode();\n      \n      await tester.pumpWidget(\n        MaterialApp(\n          theme: AppTheme.lightTheme,\n          home: Scaffold(\n            body: Center(\n              child: SizedBox(\n                width: 400,\n                child: Form(\n                  child: ShareInputWidget(\n                    controller: controller,\n                    focusNode: focusNode,\n                    index: 2,\n                    canRemove: true,\n                    onRemove: () {},\n                    onPaste: () {},\n                  ),\n                ),\n              ),\n            ),\n          ),\n        ),\n      );\n      \n      await expectLater(\n        find.byType(ShareInputWidget),\n        matchesGoldenFile('share_input_removable.png'),\n      );\n      \n      controller.dispose();\n      focusNode.dispose();\n    });\n    \n    testWidgets('share input widget - non-removable', (tester) async {\n      final controller = TextEditingController();\n      final focusNode = FocusNode();\n      \n      await tester.pumpWidget(\n        MaterialApp(\n          theme: AppTheme.lightTheme,\n          home: Scaffold(\n            body: Center(\n              child: SizedBox(\n                width: 400,\n                child: Form(\n                  child: ShareInputWidget(\n                    controller: controller,\n                    focusNode: focusNode,\n                    index: 0,\n                    canRemove: false,\n                    onRemove: () {},\n                    onPaste: () {},\n                  ),\n                ),\n              ),\n            ),\n          ),\n        ),\n      );\n      \n      await expectLater(\n        find.byType(ShareInputWidget),\n        matchesGoldenFile('share_input_non_removable.png'),\n      );\n      \n      controller.dispose();\n      focusNode.dispose();\n    });\n    \n    testWidgets('threshold config widget - default values', (tester) async {\n      final thresholdController = TextEditingController(text: '3');\n      final totalSharesController = TextEditingController(text: '5');\n      \n      await tester.pumpWidget(\n        MaterialApp(\n          theme: AppTheme.lightTheme,\n          home: Scaffold(\n            body: Center(\n              child: SizedBox(\n                width: 450,\n                child: Form(\n                  child: ThresholdConfigWidget(\n                    thresholdController: thresholdController,\n                    totalSharesController: totalSharesController,\n                  ),\n                ),\n              ),\n            ),\n          ),\n        ),\n      );\n      \n      await expectLater(\n        find.byType(ThresholdConfigWidget),\n        matchesGoldenFile('threshold_config_default.png'),\n      );\n      \n      thresholdController.dispose();\n      totalSharesController.dispose();\n    });\n    \n    testWidgets('threshold config widget - custom values', (tester) async {\n      final thresholdController = TextEditingController(text: '7');\n      final totalSharesController = TextEditingController(text: '10');\n      \n      await tester.pumpWidget(\n        MaterialApp(\n          theme: AppTheme.lightTheme,\n          home: Scaffold(\n            body: Center(\n              child: SizedBox(\n                width: 450,\n                child: Form(\n                  child: ThresholdConfigWidget(\n                    thresholdController: thresholdController,\n                    totalSharesController: totalSharesController,\n                  ),\n                ),\n              ),\n            ),\n          ),\n        ),\n      );\n      \n      await expectLater(\n        find.byType(ThresholdConfigWidget),\n        matchesGoldenFile('threshold_config_custom.png'),\n      );\n      \n      thresholdController.dispose();\n      totalSharesController.dispose();\n    });\n  });\n  \n  group('Responsive Layout Golden Tests', () {\n    testWidgets('PIN input widget - tablet size', (tester) async {\n      await tester.binding.setSurfaceSize(const Size(800, 1200));\n      \n      await tester.pumpWidget(\n        MaterialApp(\n          theme: AppTheme.lightTheme,\n          home: Scaffold(\n            body: Center(\n              child: PinInputWidget(\n                onCompleted: (pin) {},\n              ),\n            ),\n          ),\n        ),\n      );\n      \n      await expectLater(\n        find.byType(PinInputWidget),\n        matchesGoldenFile('pin_input_tablet.png'),\n      );\n    });\n    \n    testWidgets('threshold config widget - tablet landscape', (tester) async {\n      await tester.binding.setSurfaceSize(const Size(1200, 800));\n      \n      final thresholdController = TextEditingController(text: '3');\n      final totalSharesController = TextEditingController(text: '5');\n      \n      await tester.pumpWidget(\n        MaterialApp(\n          theme: AppTheme.lightTheme,\n          home: Scaffold(\n            body: Center(\n              child: Form(\n                child: ThresholdConfigWidget(\n                  thresholdController: thresholdController,\n                  totalSharesController: totalSharesController,\n                ),\n              ),\n            ),\n          ),\n        ),\n      );\n      \n      await expectLater(\n        find.byType(ThresholdConfigWidget),\n        matchesGoldenFile('threshold_config_tablet_landscape.png'),\n      );\n      \n      thresholdController.dispose();\n      totalSharesController.dispose();\n    });\n  });\n  \n  group('Widget Combination Golden Tests', () {\n    testWidgets('complete form layout - create secret', (tester) async {\n      final nameController = TextEditingController(text: 'My Important Secret');\n      final secretController = TextEditingController(text: 'This is my secret content that needs to be protected');\n      final thresholdController = TextEditingController(text: '3');\n      final totalSharesController = TextEditingController(text: '5');\n      \n      await tester.pumpWidget(\n        MaterialApp(\n          theme: AppTheme.lightTheme,\n          home: Scaffold(\n            body: SingleChildScrollView(\n              padding: const EdgeInsets.all(16),\n              child: SizedBox(\n                width: 400,\n                child: Form(\n                  child: Column(\n                    crossAxisAlignment: CrossAxisAlignment.stretch,\n                    children: [\n                      const SecretFormHeader(\n                        title: 'Create Secret Shares',\n                        subtitle: 'Split your secret into multiple shares using Shamir\\'s Secret Sharing algorithm',\n                        icon: Icons.add_circle_outline,\n                      ),\n                      const SizedBox(height: 16),\n                      TextFormField(\n                        controller: nameController,\n                        decoration: const InputDecoration(\n                          labelText: 'Secret Name',\n                          hintText: 'Enter a name for your secret',\n                          prefixIcon: Icon(Icons.label),\n                        ),\n                      ),\n                      const SizedBox(height: 16),\n                      TextFormField(\n                        controller: secretController,\n                        decoration: const InputDecoration(\n                          labelText: 'Secret',\n                          hintText: 'Enter your secret text',\n                          prefixIcon: Icon(Icons.security),\n                        ),\n                        maxLines: 3,\n                      ),\n                      const SizedBox(height: 24),\n                      ThresholdConfigWidget(\n                        thresholdController: thresholdController,\n                        totalSharesController: totalSharesController,\n                      ),\n                      const SizedBox(height: 24),\n                      SizedBox(\n                        width: double.infinity,\n                        child: ElevatedButton(\n                          onPressed: () {},\n                          child: const Text('Create Secret Shares'),\n                        ),\n                      ),\n                    ],\n                  ),\n                ),\n              ),\n            ),\n          ),\n        ),\n      );\n      \n      await expectLater(\n        find.byType(Scaffold),\n        matchesGoldenFile('create_secret_form_complete.png'),\n      );\n      \n      nameController.dispose();\n      secretController.dispose();\n      thresholdController.dispose();\n      totalSharesController.dispose();\n    });\n    \n    testWidgets('complete form layout - reconstruct secret', (tester) async {\n      final shareController1 = TextEditingController(text: 'Share 1 data here...');\n      final shareController2 = TextEditingController(text: 'Share 2 data here...');\n      final focusNode1 = FocusNode();\n      final focusNode2 = FocusNode();\n      \n      await tester.pumpWidget(\n        MaterialApp(\n          theme: AppTheme.lightTheme,\n          home: Scaffold(\n            body: SingleChildScrollView(\n              padding: const EdgeInsets.all(16),\n              child: SizedBox(\n                width: 400,\n                child: Form(\n                  child: Column(\n                    crossAxisAlignment: CrossAxisAlignment.stretch,\n                    children: [\n                      const SecretFormHeader(\n                        title: 'Reconstruct Secret',\n                        subtitle: 'Enter the required number of shares to reconstruct your original secret',\n                        icon: Icons.restore,\n                        infoText: 'You need at least k shares (threshold) to reconstruct the secret',\n                      ),\n                      const SizedBox(height: 16),\n                      ShareInputWidget(\n                        controller: shareController1,\n                        focusNode: focusNode1,\n                        index: 0,\n                        canRemove: false,\n                        onRemove: () {},\n                        onPaste: () {},\n                      ),\n                      ShareInputWidget(\n                        controller: shareController2,\n                        focusNode: focusNode2,\n                        index: 1,\n                        canRemove: true,\n                        onRemove: () {},\n                        onPaste: () {},\n                      ),\n                      OutlinedButton.icon(\n                        onPressed: () {},\n                        icon: const Icon(Icons.add),\n                        label: const Text('Add Share'),\n                      ),\n                      const SizedBox(height: 24),\n                      SizedBox(\n                        width: double.infinity,\n                        child: ElevatedButton(\n                          onPressed: () {},\n                          child: const Text('Reconstruct Secret'),\n                        ),\n                      ),\n                    ],\n                  ),\n                ),\n              ),\n            ),\n          ),\n        ),\n      );\n      \n      await expectLater(\n        find.byType(Scaffold),\n        matchesGoldenFile('reconstruct_secret_form_complete.png'),\n      );\n      \n      shareController1.dispose();\n      shareController2.dispose();\n      focusNode1.dispose();\n      focusNode2.dispose();\n    });\n  });\n}